(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function o(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=o(a);fetch(a.href,i)}})();const s={compressBtn:"compress-image-btn",compressedImagePreview:"compressed-image-preview",compressedSize:"compressed-size",downloadBtn:"download-image-btn",fileInput:"file-input",fileName:"file-name",inputDropArea:"input-drop-area",languageSelector:"language-selector",modalCloseBtn:"modal-close-btn",modalOverlay:"modal-overlay",notification:"notification",originalSize:"original-size",removeFileBtn:"remove-file-name",sizeObservation:"size-observation",slider:"quality-slider",sliderValue:"quality-value"},l=e=>document.getElementById(e),W="modulepreload",G=function(e,n){return new URL(e,n).href},I={},Q=function(n,o,r){let a=Promise.resolve();if(o&&o.length>0){let w=function(u){return Promise.all(u.map(f=>Promise.resolve(f).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};const c=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),g=d?.nonce||d?.getAttribute("nonce");a=w(o.map(u=>{if(u=G(u,r),u in I)return;I[u]=!0;const f=u.endsWith(".css"),m=f?'[rel="stylesheet"]':"";if(!!r)for(let y=c.length-1;y>=0;y--){const L=c[y];if(L.href===u&&(!f||L.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${m}`))return;const p=document.createElement("link");if(p.rel=f?"stylesheet":W,f||(p.as="script"),p.crossOrigin="",p.href=u,g&&p.setAttribute("nonce",g),document.head.appendChild(p),f)return new Promise((y,L)=>{p.addEventListener("load",y),p.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(c){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c}return a.then(c=>{for(const d of c||[])d.status==="rejected"&&i(d.reason);return n().catch(i)})};let h=null;async function K(){if(h)return h;const{default:e}=await Q(async()=>{const{default:n}=await import("./compress-C9b2V1G6.js");return{default:n}},[],import.meta.url);if(h=await e(),typeof h._malloc!="function"||!h.HEAPU8)throw new Error("WASM module was not initialized correctly: missing _malloc or HEAPU8");return h}async function J(e,n,o,r,a){const i=await K(),c=e.length,d=i._malloc(c);if(d===0)throw new Error("Failed to allocate memory for the image data.");i.HEAPU8.set(e,d);const g=i._malloc(4),w=i._compressImageToJpg(d,n,o,r,a,g),u=i.HEAP32[g>>2];if(w===0||u===0)throw i._free(d),i._free(g),new Error("Failed to compress image.");const f=new Uint8Array(i.HEAPU8.buffer,w,u),m=new Uint8Array(f);return i._free(d),i._free(g),i._freeCompressedImage(w),m}let D;function E(e,n="error",o=4e3){window.gtag&&gtag("event","show_notification",{message:e,type:n,duration:o});const r=l(s.notification);r.textContent=e,r.classList.remove("hidden"),r.classList.remove("bg-red-500","bg-green-500"),r.classList.add(n==="error"?"bg-red-500":"bg-green-500"),clearTimeout(D),D=setTimeout(()=>{r.classList.add("hidden")},o)}const X=l(s.inputDropArea),Y=l(s.fileInput),C=l(s.fileName),Z=l(s.removeFileBtn);l(s.compressBtn);function A(){const e=l(s.fileInput),n=l(s.compressBtn),o=e?.files?.length>0;n&&(n.disabled=!o,n.setAttribute("aria-disabled",n.disabled?"true":"false"),o?n.removeAttribute("title"):n.setAttribute("title","Adicioneuma imagem para comprimir")),C&&(C.textContent=o?e?.files[0].name:"Nenhum arquivo selecionado"),Z?.classList?.toggle("hidden",!o)}function ee(){const e=l(s.fileInput);return e.files.length>0?e.files[0]:null}function k(e){const n=new DataTransfer;n.items.add(e),Y.files=n.files,A()}function U(){const e=l(s.fileInput);e.value="",A()}function P(e){e.type==="keydown"&&!(e.key==="Enter"||e.key===" ")||(F(e),U(),window.gtag&&gtag("event","file_removed"),X.focus())}function te(){const e=l(s.inputDropArea);e.style.borderColor="#3a86ff",e.style.background="#f3f4f6"}function S(){const e=l(s.inputDropArea);e.style.borderColor="#d1d5dc",e.style.background=""}function F(e){e.preventDefault(),e.stopPropagation()}function ne(){const e=l(s.inputDropArea),n=l(s.fileInput),o=l(s.removeFileBtn);e.addEventListener("click",()=>{window.gtag&&gtag("event","input_droparea_clicked"),n.click()}),e.addEventListener("keydown",r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),n.click())}),n.addEventListener("change",()=>{const r=n.files[0];if(r){if(!r.type.startsWith("image/")){showNotification(t("error.unsupported_file"),"error");return}window.gtag&&gtag("event","file_selected"),k(r)}}),o.addEventListener("click",P),o.addEventListener("keydown",P),["dragenter","dragover","dragleave","drop"].forEach(r=>{e.addEventListener(r,F)}),e.addEventListener("dragover",r=>{r.dataTransfer.dropEffect="copy",te()}),e.addEventListener("dragleave",()=>{S()}),e.addEventListener("drop",r=>{const a=r.dataTransfer.files;if(!a||!a[0]){showNotification(t("error.invalid_file"),"error");return}k(a[0]),S(),window.gtag&&gtag("event","input_droparea_dropped")},!0)}let B="pt",H={};async function T(e="pt"){try{H=await(await fetch(`./i18n/${e}.json`)).json(),B=e,oe(),window.gtag&&gtag("event","language_changed",{language:e})}catch(n){console.error("Error to load language",n),E(v("error.language_load_fail"))}}function v(e){return H[e]||e}function oe(){document.querySelectorAll("[data-i18n]").forEach(e=>{const n=e.dataset.i18n,o=v(n);typeof o=="string"&&o.length>0&&(/<\/?[a-z][\s\S]*>/i.test(o)?e.innerHTML=o:e.textContent=o,A())})}function re(){const e=document.getElementById("language-selector");if(!e)return;const n=e.querySelectorAll("button[data-lang]");n.forEach(o=>{o.addEventListener("click",async()=>{const r=o.dataset.lang;r&&r!==B&&(await T(r),z(n,r))})}),z(n,B)}function z(e,n){e.forEach(o=>{o.dataset.lang===n?o.classList.add("scale-120"):o.classList.remove("scale-120")})}const $=l(s.compressedImagePreview),M=l(s.compressedSize),b=l(s.downloadBtn),ie=l(s.languageSelector),N=l(s.modalOverlay),q=l(s.originalSize),R=l(s.sizeObservation);let _=null;function j(){_&&(URL.revokeObjectURL(_),_=null)}function ae(){window.gtag&&gtag("event","modal_close_btn_clicked"),j(),U(),N.classList.add("hidden"),R.classList.add("hidden"),ie.classList.remove("hidden"),$.src="",q.textContent="",M.textContent="",b.disabled=!0,b.setAttribute("aria-disabled","true")}function se(){l(s.modalCloseBtn).addEventListener("click",ae)}function x(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`}function le(e,n,o){j(),_=e,$.src=e,N.classList.remove("hidden"),b.disabled=!1,b.setAttribute("aria-disabled","false"),q.textContent=x(n),M.textContent=x(o),window.gtag&&gtag("event","compression_sucess",{original_size:n,compressed_size:o}),n<o&&(R.classList.remove("hidden"),window.gtag&&gtag("event","compression_worse_than_original",{original_size:n,compressed_size:o}))}function ce(){return _}function de(e,n){const o=document.createElement("a");o.href=e,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function ue(){const e=ce();if(!e){window.gtag&&gtag("event","download_clicked_error",{error:v("error.no_image_to_download")}),E(v("error.no_image_to_download"),"error");return}window.gtag&&gtag("event","download_clicked",{blob_url:e}),de(e,"compressed_image.jpg")}function fe(){l(s.downloadBtn).addEventListener("click",ue)}const V=l(s.slider),ge=l(s.sliderValue);function me(){V.addEventListener("input",e=>{const n=e.target.value;ge.textContent=n,window.gtag&&gtag("event","quality_changed",{quality:n})})}function pe(){return parseInt(V.value,10)}const O="G-PK0MQW8S1D",we=l(s.compressBtn),he=l(s.languageSelector);function ve(){{const n=document.createElement("script");n.async=!0,n.src=`https://www.googletagmanager.com/gtag/js?id=${O}`,document.head.appendChild(n)}const e=document.createElement("script");e.innerHTML=`
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', '${O}');
  `,document.head.appendChild(e)}async function ye(){ve(),await T("pt"),re(),ne(),me(),se(),fe(),we.addEventListener("click",async()=>{he.classList.add("hidden");const e=ee(),n=pe();if(window.gtag&&gtag("event","compress_btn_clicked",{file_name:e?.name,file_size:e?.size,selected_quality:n}),!e){E(v("error.no_file"));return}try{const o=await createImageBitmap(e),{width:r,height:a}=o,i=document.createElement("canvas");i.width=r,i.height=a;const c=i.getContext("2d");c.drawImage(o,0,0);const g=c.getImageData(0,0,r,a).data,w=g.length/(r*a),u=await J(new Uint8Array(g.buffer),r,a,w,n),f=new Blob([u],{type:"image/jpeg"}),m=URL.createObjectURL(f);le(m,e.size,f.size)}catch(o){console.error("Error compressing the image: ",o),E(v("error.compression_failed"),"error")}})}document.addEventListener("DOMContentLoaded",ye);export{Q as _};
