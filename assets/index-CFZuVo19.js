(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function o(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=o(a);fetch(a.href,i)}})();const s={compressBtn:"compress-image-btn",compressedImagePreview:"compressed-image-preview",compressedSize:"compressed-size",downloadBtn:"download-image-btn",fileInput:"file-input",fileName:"file-name",inputDropArea:"input-drop-area",languageSelector:"language-selector",modalCloseBtn:"modal-close-btn",modalOverlay:"modal-overlay",notification:"notification",originalSize:"original-size",removeFileBtn:"remove-file-name",sizeObservation:"size-observation",slider:"quality-slider",sliderValue:"quality-value"},l=e=>document.getElementById(e),W="modulepreload",Q=function(e,n){return new URL(e,n).href},C={},J=function(n,o,r){let a=Promise.resolve();if(o&&o.length>0){let h=function(u){return Promise.all(u.map(f=>Promise.resolve(f).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};const c=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),m=d?.nonce||d?.getAttribute("nonce");a=h(o.map(u=>{if(u=Q(u,r),u in C)return;C[u]=!0;const f=u.endsWith(".css"),p=f?'[rel="stylesheet"]':"";if(!!r)for(let y=c.length-1;y>=0;y--){const b=c[y];if(b.href===u&&(!f||b.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${p}`))return;const g=document.createElement("link");if(g.rel=f?"stylesheet":W,f||(g.as="script"),g.crossOrigin="",g.href=u,m&&g.setAttribute("nonce",m),document.head.appendChild(g),f)return new Promise((y,b)=>{g.addEventListener("load",y),g.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(c){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c}return a.then(c=>{for(const d of c||[])d.status==="rejected"&&i(d.reason);return n().catch(i)})};let v=null;async function K(){if(v)return v;const{default:e}=await J(async()=>{const{default:n}=await import("./compress-UgNEBfve.js");return{default:n}},[],import.meta.url);if(v=await e(),typeof v._malloc!="function"||!v.HEAPU8)throw new Error("WASM module was not initialized correctly: missing _malloc or HEAPU8");return v}async function G(e,n,o,r,a){const i=await K(),c=e.length,d=i._malloc(c);if(d===0)throw new Error("Failed to allocate memory for the image data.");i.HEAPU8.set(e,d);const m=i._malloc(4),h=i._compressImageToJpg(d,n,o,r,a,m),u=i.HEAP32[m>>2];if(h===0||u===0)throw i._free(d),i._free(m),new Error("Failed to compress image.");const f=new Uint8Array(i.HEAPU8.buffer,h,u),p=new Uint8Array(f);return i._free(d),i._free(m),i._freeCompressedImage(h),p}let D;function B(e,n="error",o=4e3){const r=l(s.notification);r.textContent=e,r.classList.remove("hidden"),r.classList.remove("bg-red-500","bg-green-500"),r.classList.add(n==="error"?"bg-red-500":"bg-green-500"),clearTimeout(D),D=setTimeout(()=>{r.classList.add("hidden")},o)}let A="pt",O={};async function z(e="pt"){try{O=await(await fetch(`./i18n/${e}.json`)).json(),A=e,X()}catch(n){console.error("Error to load language",n),B(E("error.language_load_fail"))}}function E(e){return O[e]||e}function X(){document.querySelectorAll("[data-i18n]").forEach(e=>{const n=e.dataset.i18n,o=E(n);typeof o=="string"&&o.length>0&&(/<\/?[a-z][\s\S]*>/i.test(o)?e.innerHTML=o:e.textContent=o)})}function Y(){const e=document.getElementById("language-selector");if(!e)return;const n=e.querySelectorAll("button[data-lang]");n.forEach(o=>{o.addEventListener("click",async()=>{const r=o.dataset.lang;r&&r!==A&&(await z(r),_(n,r))})}),_(n,A)}function _(e,n){e.forEach(o=>{o.dataset.lang===n?o.classList.add("scale-120"):o.classList.remove("scale-120")})}const Z=l(s.inputDropArea),S=l(s.fileInput),ee=l(s.fileName),te=l(s.removeFileBtn),w=l(s.compressBtn);function F(){const e=S.files.length>0;w.disabled=!e,w.setAttribute("aria-disabled",w.disabled?"true":"false"),e?w.removeAttribute("title"):w.setAttribute("title","Adicioneuma imagem para comprimir"),ee.textContent=e?S.files[0].name:"Nenhum arquivo selecionado",te.classList.toggle("hidden",!e)}function ne(){const e=l(s.fileInput);return e.files.length>0?e.files[0]:null}function P(e){const n=new DataTransfer;n.items.add(e),S.files=n.files,F()}function H(){const e=l(s.fileInput);e.value="",F()}function k(e){e.type==="keydown"&&!(e.key==="Enter"||e.key===" ")||(T(e),H(),Z.focus())}function oe(){const e=l(s.inputDropArea);e.style.borderColor="#3a86ff",e.style.background="#f3f4f6"}function U(){const e=l(s.inputDropArea);e.style.borderColor="#d1d5dc",e.style.background=""}function T(e){e.preventDefault(),e.stopPropagation()}function re(){const e=l(s.inputDropArea),n=l(s.fileInput),o=l(s.removeFileBtn);e.addEventListener("click",()=>n.click()),e.addEventListener("keydown",r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),n.click())}),n.addEventListener("change",()=>{const r=n.files[0];if(r){if(!r.type.startsWith("image/")){showNotification(t("error.unsupported_file"),"error");return}P(r)}}),o.addEventListener("click",k),o.addEventListener("keydown",k),["dragenter","dragover","dragleave","drop"].forEach(r=>{e.addEventListener(r,T)}),e.addEventListener("dragover",r=>{r.dataTransfer.dropEffect="copy",oe()}),e.addEventListener("dragleave",()=>{U()}),e.addEventListener("drop",r=>{const a=r.dataTransfer.files;if(!a||!a[0]){showNotification(t("error.invalid_file"),"error");return}P(a[0]),U()},!0)}const $=l(s.compressedImagePreview),N=l(s.compressedSize),I=l(s.downloadBtn),ie=l(s.languageSelector),M=l(s.modalOverlay),R=l(s.originalSize),q=l(s.sizeObservation);let L=null;function j(){L&&(URL.revokeObjectURL(L),L=null)}function ae(){j(),H(),M.classList.add("hidden"),q.classList.add("hidden"),ie.classList.remove("hidden"),$.src="",R.textContent="",N.textContent="",I.disabled=!0,I.setAttribute("aria-disabled","true")}function se(){l(s.modalCloseBtn).addEventListener("click",ae)}function x(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`}function le(e,n,o){j(),L=e,$.src=e,M.classList.remove("hidden"),I.disabled=!1,I.setAttribute("aria-disabled","false"),R.textContent=x(n),N.textContent=x(o),n<o&&q.classList.remove("hidden")}function ce(){return L}function de(e,n){const o=document.createElement("a");o.href=e,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function ue(){const e=ce();if(console.log("blobUrl =",e),!e){console.log("entrou aqui"),B(E("error.no_image_to_download"),"error");return}de(e,"compressed_image.jpg")}function fe(){l(s.downloadBtn).addEventListener("click",ue)}const V=l(s.slider),me=l(s.sliderValue);function pe(){V.addEventListener("input",e=>{me.textContent=e.target.value})}function ge(){return parseInt(V.value,10)}const he=l(s.compressBtn),ve=l(s.languageSelector);async function ye(){await z("pt"),Y(),re(),pe(),se(),fe(),he.addEventListener("click",async()=>{ve.classList.add("hidden");const e=ne(),n=ge();if(!e){B(E("error.no_file"));return}try{const o=await createImageBitmap(e),{width:r,height:a}=o,i=document.createElement("canvas");i.width=r,i.height=a;const c=i.getContext("2d");c.drawImage(o,0,0);const m=c.getImageData(0,0,r,a).data,h=m.length/(r*a),u=await G(new Uint8Array(m.buffer),r,a,h,n),f=new Blob([u],{type:"image/jpeg"}),p=URL.createObjectURL(f);le(p,e.size,f.size)}catch(o){console.error("Error compressing the image: ",o),B(E("error.compression_failed"),"error")}})}document.addEventListener("DOMContentLoaded",ye);export{J as _};
