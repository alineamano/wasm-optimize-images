(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=o(a);fetch(a.href,i)}})();const s={compressBtn:"compress-image-btn",compressedImagePreview:"compressed-image-preview",compressedSize:"compressed-size",downloadBtn:"download-image-btn",fileInput:"file-input",fileName:"file-name",inputDropArea:"input-drop-area",languageSelector:"language-selector",modalCloseBtn:"modal-close-btn",modalOverlay:"modal-overlay",notification:"notification",originalSize:"original-size",removeFileBtn:"remove-file-name",sizeObservation:"size-observation",slider:"quality-slider",sliderValue:"quality-value"},c=e=>document.getElementById(e),V="modulepreload",W=function(e,n){return new URL(e,n).href},I={},Q=function(n,o,r){let a=Promise.resolve();if(o&&o.length>0){let w=function(u){return Promise.all(u.map(m=>Promise.resolve(m).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};const l=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),f=d?.nonce||d?.getAttribute("nonce");a=w(o.map(u=>{if(u=W(u,r),u in I)return;I[u]=!0;const m=u.endsWith(".css"),p=m?'[rel="stylesheet"]':"";if(!!r)for(let y=l.length-1;y>=0;y--){const L=l[y];if(L.href===u&&(!m||L.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${p}`))return;const g=document.createElement("link");if(g.rel=m?"stylesheet":V,m||(g.as="script"),g.crossOrigin="",g.href=u,f&&g.setAttribute("nonce",f),document.head.appendChild(g),m)return new Promise((y,L)=>{g.addEventListener("load",y),g.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(l){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=l,window.dispatchEvent(d),!d.defaultPrevented)throw l}return a.then(l=>{for(const d of l||[])d.status==="rejected"&&i(d.reason);return n().catch(i)})};let h=null;async function J(){if(h)return h;const{default:e}=await Q(async()=>{const{default:n}=await import("./compress-CYHNlvdS.js");return{default:n}},[],import.meta.url);if(h=await e(),typeof h._malloc!="function"||!h.HEAPU8)throw new Error("WASM module was not initialized correctly: missing _malloc or HEAPU8");return h}async function K(e,n,o,r,a){const i=await J(),l=e.length,d=i._malloc(l);if(d===0)throw new Error("Failed to allocate memory for the image data.");i.HEAPU8.set(e,d);const f=i._malloc(4),w=i._compressImageToJpg(d,n,o,r,a,f),u=i.HEAP32[f>>2];if(w===0||u===0)throw i._free(d),i._free(f),new Error("Failed to compress image.");const m=new Uint8Array(i.HEAPU8.buffer,w,u),p=new Uint8Array(m);return i._free(d),i._free(f),i._freeCompressedImage(w),p}let A;function b(e,n="error",o=4e3){window.umami?.track("show_notification",{message:e,type:n,duration:o});const r=c(s.notification);r.textContent=e,r.classList.remove("hidden"),r.classList.remove("bg-red-500","bg-green-500"),r.classList.add(n==="error"?"bg-red-500":"bg-green-500"),clearTimeout(A),A=setTimeout(()=>{r.classList.add("hidden")},o)}const G=c(s.inputDropArea),X=c(s.fileInput),C=c(s.fileName),Y=c(s.removeFileBtn);c(s.compressBtn);function B(){const e=c(s.fileInput),n=c(s.compressBtn),o=e?.files?.length>0;n&&(n.disabled=!o,n.setAttribute("aria-disabled",n.disabled?"true":"false"),o?n.removeAttribute("title"):n.setAttribute("title","Adicioneuma imagem para comprimir")),C&&(C.textContent=o?e?.files[0].name:"Nenhum arquivo selecionado"),Y?.classList?.toggle("hidden",!o)}function Z(){const e=c(s.fileInput);return e.files.length>0?e.files[0]:null}function D(e){const n=new DataTransfer;n.items.add(e),X.files=n.files,B()}function O(){const e=c(s.fileInput);e.value="",B()}function P(e){e.type==="keydown"&&!(e.key==="Enter"||e.key===" ")||(z(e),O(),window.umami?.track("file_removed"),G.focus())}function ee(){const e=c(s.inputDropArea);e.style.borderColor="#3a86ff",e.style.background="#f3f4f6"}function S(){const e=c(s.inputDropArea);e.style.borderColor="#d1d5dc",e.style.background=""}function z(e){e.preventDefault(),e.stopPropagation()}function te(){const e=c(s.inputDropArea),n=c(s.fileInput),o=c(s.removeFileBtn);e.addEventListener("click",()=>{window.umami?.track("input_droparea_clicked"),n.click()}),e.addEventListener("keydown",r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),n.click())}),n.addEventListener("change",()=>{const r=n.files[0];if(r){if(!r.type.startsWith("image/")){showNotification(t("error.unsupported_file"),"error");return}window.umami?.track("file_selected"),D(r)}}),o.addEventListener("click",P),o.addEventListener("keydown",P),["dragenter","dragover","dragleave","drop"].forEach(r=>{e.addEventListener(r,z)}),e.addEventListener("dragover",r=>{r.dataTransfer.dropEffect="copy",ee()}),e.addEventListener("dragleave",()=>{S()}),e.addEventListener("drop",r=>{const a=r.dataTransfer.files;if(!a||!a[0]){showNotification(t("error.invalid_file"),"error");return}D(a[0]),S(),window.umami?.track("input_droparea_dropped")},!0)}let k="pt",F={};async function H(e="pt"){try{F=await(await fetch(`./i18n/${e}.json`)).json(),k=e,ne(),window.umami?.track("language_changed",{language:e})}catch(n){console.error("Error to load language",n),b(v("error.language_load_fail"))}}function v(e){return F[e]||e}function ne(){document.querySelectorAll("[data-i18n]").forEach(e=>{const n=e.dataset.i18n,o=v(n);typeof o=="string"&&o.length>0&&(/<\/?[a-z][\s\S]*>/i.test(o)?e.innerHTML=o:e.textContent=o,B())})}function oe(){const e=document.getElementById("language-selector");if(!e)return;const n=e.querySelectorAll("button[data-lang]");n.forEach(o=>{o.addEventListener("click",async()=>{const r=o.dataset.lang;r&&r!==k&&(await H(r),U(n,r))})}),U(n,k)}function U(e,n){e.forEach(o=>{o.dataset.lang===n?o.classList.add("scale-120"):o.classList.remove("scale-120")})}const T=c(s.compressedImagePreview),N=c(s.compressedSize),E=c(s.downloadBtn),re=c(s.languageSelector),$=c(s.modalOverlay),M=c(s.originalSize),q=c(s.sizeObservation);let _=null;function R(){_&&(URL.revokeObjectURL(_),_=null)}function ie(){window.umami?.track("modal_close_btn_clicked"),R(),O(),$.classList.add("hidden"),q.classList.add("hidden"),re.classList.remove("hidden"),T.src="",M.textContent="",N.textContent="",E.disabled=!0,E.setAttribute("aria-disabled","true")}function ae(){c(s.modalCloseBtn).addEventListener("click",ie)}function x(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`}function se(e,n,o){R(),_=e,T.src=e,$.classList.remove("hidden"),E.disabled=!1,E.setAttribute("aria-disabled","false"),M.textContent=x(n),N.textContent=x(o),window.umami?.track("compression_sucess",{original_size:n,compressed_size:o}),n<o&&(q.classList.remove("hidden"),window.umami?.track("compression_worse_than_original",{original_size:n,compressed_size:o}))}function ce(){return _}function le(e,n){const o=document.createElement("a");o.href=e,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function de(){const e=ce();if(!e){window.umami?.track("download_clicked_error",{error:v("error.no_image_to_download")}),b(v("error.no_image_to_download"),"error");return}window.umami?.track("download_clicked",{blobUrl:e}),le(e,"compressed_image.jpg")}function ue(){c(s.downloadBtn).addEventListener("click",de)}const j=c(s.slider),me=c(s.sliderValue);function fe(){j.addEventListener("input",e=>{const n=e.target.value;me.textContent=n,window.umami?.track("quality_changed",{quality:n})})}function pe(){return parseInt(j.value,10)}const ge=c(s.compressBtn),we=c(s.languageSelector);function he(){{const e=document.createElement("script");e.defer=!0,e.src="https://umami-alineamanos-projects.vercel.app/script.js",e.setAttribute("data-website-id","522d3c78-8746-4249-bcb9-180a7c03c621"),document.head.appendChild(e)}}async function ve(){he(),await H("pt"),oe(),te(),fe(),ae(),ue(),ge.addEventListener("click",async()=>{we.classList.add("hidden");const e=Z(),n=pe();if(window.umami?.track("compress_btn_clicked",{file:e,select_quality:n}),!e){b(v("error.no_file"));return}try{const o=await createImageBitmap(e),{width:r,height:a}=o,i=document.createElement("canvas");i.width=r,i.height=a;const l=i.getContext("2d");l.drawImage(o,0,0);const f=l.getImageData(0,0,r,a).data,w=f.length/(r*a),u=await K(new Uint8Array(f.buffer),r,a,w,n),m=new Blob([u],{type:"image/jpeg"}),p=URL.createObjectURL(m);se(p,e.size,m.size)}catch(o){console.error("Error compressing the image: ",o),b(v("error.compression_failed"),"error")}})}document.addEventListener("DOMContentLoaded",ve);export{Q as _};
