(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=o(a);fetch(a.href,i)}})();const s={compressBtn:"compress-image-btn",compressedImagePreview:"compressed-image-preview",compressedSize:"compressed-size",downloadBtn:"download-image-btn",fileInput:"file-input",fileName:"file-name",inputDropArea:"input-drop-area",languageSelector:"language-selector",modalCloseBtn:"modal-close-btn",modalOverlay:"modal-overlay",notification:"notification",originalSize:"original-size",removeFileBtn:"remove-file-name",sizeObservation:"size-observation",slider:"quality-slider",sliderValue:"quality-value"},c=e=>document.getElementById(e),W="modulepreload",Q=function(e,n){return new URL(e,n).href},I={},J=function(n,o,r){let a=Promise.resolve();if(o&&o.length>0){let w=function(u){return Promise.all(u.map(m=>Promise.resolve(m).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};const l=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),f=d?.nonce||d?.getAttribute("nonce");a=w(o.map(u=>{if(u=Q(u,r),u in I)return;I[u]=!0;const m=u.endsWith(".css"),p=m?'[rel="stylesheet"]':"";if(!!r)for(let y=l.length-1;y>=0;y--){const E=l[y];if(E.href===u&&(!m||E.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${p}`))return;const g=document.createElement("link");if(g.rel=m?"stylesheet":W,m||(g.as="script"),g.crossOrigin="",g.href=u,f&&g.setAttribute("nonce",f),document.head.appendChild(g),m)return new Promise((y,E)=>{g.addEventListener("load",y),g.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(l){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=l,window.dispatchEvent(d),!d.defaultPrevented)throw l}return a.then(l=>{for(const d of l||[])d.status==="rejected"&&i(d.reason);return n().catch(i)})};let h=null;async function K(){if(h)return h;const{default:e}=await J(async()=>{const{default:n}=await import("./compress-Bs-9STYU.js");return{default:n}},[],import.meta.url);if(h=await e(),typeof h._malloc!="function"||!h.HEAPU8)throw new Error("WASM module was not initialized correctly: missing _malloc or HEAPU8");return h}async function G(e,n,o,r,a){const i=await K(),l=e.length,d=i._malloc(l);if(d===0)throw new Error("Failed to allocate memory for the image data.");i.HEAPU8.set(e,d);const f=i._malloc(4),w=i._compressImageToJpg(d,n,o,r,a,f),u=i.HEAP32[f>>2];if(w===0||u===0)throw i._free(d),i._free(f),new Error("Failed to compress image.");const m=new Uint8Array(i.HEAPU8.buffer,w,u),p=new Uint8Array(m);return i._free(d),i._free(f),i._freeCompressedImage(w),p}let C;function b(e,n="error",o=4e3){window.umami?.track("show_notification",{message:e,type:n,duration:o});const r=c(s.notification);r.textContent=e,r.classList.remove("hidden"),r.classList.remove("bg-red-500","bg-green-500"),r.classList.add(n==="error"?"bg-red-500":"bg-green-500"),clearTimeout(C),C=setTimeout(()=>{r.classList.add("hidden")},o)}let B="pt",O={};async function z(e="pt"){try{O=await(await fetch(`./i18n/${e}.json`)).json(),B=e,X(),window.umami?.track("language_changed",{language:e})}catch(n){console.error("Error to load language",n),b(v("error.language_load_fail"))}}function v(e){return O[e]||e}function X(){document.querySelectorAll("[data-i18n]").forEach(e=>{const n=e.dataset.i18n,o=v(n);typeof o=="string"&&o.length>0&&(/<\/?[a-z][\s\S]*>/i.test(o)?e.innerHTML=o:e.textContent=o)})}function Y(){const e=document.getElementById("language-selector");if(!e)return;const n=e.querySelectorAll("button[data-lang]");n.forEach(o=>{o.addEventListener("click",async()=>{const r=o.dataset.lang;r&&r!==B&&(await z(r),D(n,r))})}),D(n,B)}function D(e,n){e.forEach(o=>{o.dataset.lang===n?o.classList.add("scale-120"):o.classList.remove("scale-120")})}const Z=c(s.inputDropArea),A=c(s.fileInput),ee=c(s.fileName),te=c(s.removeFileBtn),_=c(s.compressBtn);function F(){const e=A.files.length>0;_.disabled=!e,_.setAttribute("aria-disabled",_.disabled?"true":"false"),e?_.removeAttribute("title"):_.setAttribute("title","Adicioneuma imagem para comprimir"),ee.textContent=e?A.files[0].name:"Nenhum arquivo selecionado",te.classList.toggle("hidden",!e)}function ne(){const e=c(s.fileInput);return e.files.length>0?e.files[0]:null}function P(e){const n=new DataTransfer;n.items.add(e),A.files=n.files,F()}function H(){const e=c(s.fileInput);e.value="",F()}function S(e){e.type==="keydown"&&!(e.key==="Enter"||e.key===" ")||(T(e),H(),window.umami?.track("file_removed"),Z.focus())}function oe(){const e=c(s.inputDropArea);e.style.borderColor="#3a86ff",e.style.background="#f3f4f6"}function U(){const e=c(s.inputDropArea);e.style.borderColor="#d1d5dc",e.style.background=""}function T(e){e.preventDefault(),e.stopPropagation()}function re(){const e=c(s.inputDropArea),n=c(s.fileInput),o=c(s.removeFileBtn);e.addEventListener("click",()=>{window.umami?.track("input_droparea_clicked"),n.click()}),e.addEventListener("keydown",r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),n.click())}),n.addEventListener("change",()=>{const r=n.files[0];if(r){if(!r.type.startsWith("image/")){showNotification(t("error.unsupported_file"),"error");return}window.umami?.track("file_selected"),P(r)}}),o.addEventListener("click",S),o.addEventListener("keydown",S),["dragenter","dragover","dragleave","drop"].forEach(r=>{e.addEventListener(r,T)}),e.addEventListener("dragover",r=>{r.dataTransfer.dropEffect="copy",oe()}),e.addEventListener("dragleave",()=>{U()}),e.addEventListener("drop",r=>{const a=r.dataTransfer.files;if(!a||!a[0]){showNotification(t("error.invalid_file"),"error");return}P(a[0]),U(),window.umami?.track("input_droparea_dropped")},!0)}const $=c(s.compressedImagePreview),N=c(s.compressedSize),k=c(s.downloadBtn),ie=c(s.languageSelector),M=c(s.modalOverlay),q=c(s.originalSize),R=c(s.sizeObservation);let L=null;function j(){L&&(URL.revokeObjectURL(L),L=null)}function ae(){window.umami?.track("modal_close_btn_clicked"),j(),H(),M.classList.add("hidden"),R.classList.add("hidden"),ie.classList.remove("hidden"),$.src="",q.textContent="",N.textContent="",k.disabled=!0,k.setAttribute("aria-disabled","true")}function se(){c(s.modalCloseBtn).addEventListener("click",ae)}function x(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`}function ce(e,n,o){j(),L=e,$.src=e,M.classList.remove("hidden"),k.disabled=!1,k.setAttribute("aria-disabled","false"),q.textContent=x(n),N.textContent=x(o),window.umami?.track("compression_sucess",{original_size:n,compressed_size:o}),n<o&&(R.classList.remove("hidden"),window.umami?.track("compression_worse_than_original",{original_size:n,compressed_size:o}))}function le(){return L}function de(e,n){const o=document.createElement("a");o.href=e,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function ue(){const e=le();if(!e){window.umami?.track("download_clicked_error",{error:v("error.no_image_to_download")}),b(v("error.no_image_to_download"),"error");return}window.umami?.track("download_clicked",{blobUrl:e}),de(e,"compressed_image.jpg")}function me(){c(s.downloadBtn).addEventListener("click",ue)}const V=c(s.slider),fe=c(s.sliderValue);function pe(){V.addEventListener("input",e=>{const n=e.target.value;fe.textContent=n,window.umami?.track("quality_changed",{quality:n})})}function ge(){return parseInt(V.value,10)}const we=c(s.compressBtn),he=c(s.languageSelector);function ve(){{const e=document.createElement("script");e.defer=!0,e.src=void 0,e.setAttribute("data-website-id",void 0),document.head.appendChild(e)}}async function ye(){ve(),await z("pt"),Y(),re(),pe(),se(),me(),we.addEventListener("click",async()=>{he.classList.add("hidden");const e=ne(),n=ge();if(window.umami?.track("compress_btn_clicked",{file:e,select_quality:n}),!e){b(v("error.no_file"));return}try{const o=await createImageBitmap(e),{width:r,height:a}=o,i=document.createElement("canvas");i.width=r,i.height=a;const l=i.getContext("2d");l.drawImage(o,0,0);const f=l.getImageData(0,0,r,a).data,w=f.length/(r*a),u=await G(new Uint8Array(f.buffer),r,a,w,n),m=new Blob([u],{type:"image/jpeg"}),p=URL.createObjectURL(m);ce(p,e.size,m.size)}catch(o){console.error("Error compressing the image: ",o),b(v("error.compression_failed"),"error")}})}document.addEventListener("DOMContentLoaded",ye);export{J as _};
